% vim: spelllang=en spell textwidth=120
\documentclass[deska]{subfiles}
\begin{document}

\chapter{The Deska Server}
\label{sec:server-py}

\begin{abstract}
This chapter talks about deska-server, python application providing interaction with database.
\end{abstract}

FIXME: when it is start, parameters, connection to db...

\section{Command running}
For communication with deska-cli, json dbapi is used (see FIXME). On server side, this json is tranformed into python structure of dicts and lists. Some check are performed, like if command or number of arguments is right.
Most of command have their implementation inside the database, so the proper db function is called and its result is retuned. In this part, there is no special logic, just check parameter, add some defaults if it is needed and catch db exceptions.

But there are some function implemented in deska-server, like function for view freezing, which just starts or ends transaction, with isolation
level read committed, to perform the freezing of view.
Also showConfigDiff is not implemented in database. Special is commitChangeset, which has database implementation, but also needs to do generation of configuration outside the database (similar to showConfigDiff).

The combination of these 2 types is applyBatchedChangeset, which start transaction at begin, then perform its arguments, as it was a single
command, and then commit (or abort) the transaction. 
Function that calls only one database function, pass the result because it is already in proper json format, but if the function does some
more computing outside the database, or not call db function at all, it must create the result by its own.

\section{Security Model}
\label{sec:server-security-model}

The {\tt deska-server} relies heavily on the authentication/authorization features offered by the SSH server, and on the
{\tt trust = ident} feature of the PostgreSQL server.  Any Unix user who is able to connect to the PostgreSQL database
which contains the Deska installation will be able to perform any modification to the database over the standard DBAPI
calls.

FIXME: this is mainly a placeholder for further documentation\ldots

\end{document}
